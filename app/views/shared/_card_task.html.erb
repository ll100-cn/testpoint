<% task_dom_id = dom_id(task) %>
<div class="card card-collapsed collapsed <%= task.state %>" data-toggle="collapse" data-target="#<%= task_dom_id %>">
  <div class="card-body">
    <div class="card-title">
      <span><%= test_case.title %></span>
      <span class="badge badge-secondary"><%= task.platform.name %></span>
      <% if test_case.content? %>
        <% content_html = capture do %>
          <div id="<%= task_dom_id %>" class="collapse text-muted py-2">
            <article class="alert alert-warning mb-0">
              <div class="marginfix-bottom"><div class="inner">
                <%=simple_format test_case.content %>
              </div></div>
            </article>
          </div>
        <% end %>
        <span class="fa fa-fw fa-sticky-note-o text-muted"></span>
      <% end %>

      <div class="dropdown small ml-2">
        <a class="dropdown-toggle" data-toggle="dropdown">
          <%= task_state_with_icon(task.state) %>
        </a>
        <div class="dropdown-menu">
          <% action_data = { remote: true, type: "xhrml", target: ".card-task-wrapper" } %>
          <%= link_to [ @plan, task, task: { state: :pass } ], method: :patch, class: "dropdown-item small", data: action_data do %>
            <%= task_state_with_icon("pass") %>
          <% end %>
          <%= link_to [ @plan, task, task: { state: :failure } ] , method: :patch, class: "dropdown-item small", data: action_data do %>
            <%= task_state_with_icon("failure") %>
          <% end %>
        </div>
      </div>
    </div>
    <%= content_html %>
  </div>
</div>
