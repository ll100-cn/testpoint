<% unless @folders_mapping[key].nil? %>
  <% (@folders_mapping[key] || []).each do |folder| %>
    <% children = @folders_mapping[folder.id] || [] %>
    <% open = (@folder&.ancestor_ids_with_self || []).include?(folder.id) && children.any? %>
    <li class="<%= 'has-children' if children.any? %>">
      <% if children.any? %>
        <a data-toggle="collapse" data-target="#treeview-<%= folder.id %>-container" class="toggler text-muted <%= 'collapsed' if !open %> c-pointer">
          <i class="fal fa-plus-square"></i>
        </a>
      <% else %>
        <span class=""></span>
      <% end %>
      <span class="line"></span>
      <div class="item">
        <%= link_to [@project, ::TestCase, folder_id: folder.id, platform_id: @platform], class: "treeview-link flex-1 rounded  #{'active' if folder == @folder}", data: { remote: true, type: "xhrml", target: "#tp-main table", replace: true, action: "activable#active" }  do %>
          <i class="fal fa-folder mr-2"></i><%= folder.name %>（<%= @folder_test_cases_counts[folder.id] %>）
        <% end %>
        <%= link_to [ :edit, @project, folder ], class: "text-muted ml-2 treeview-active-actions" do %>
          <i class="fal fa-pencil"></i>
        <% end %>
      </div>
      <ul id="treeview-<%= folder.id %>-container" class="collapse <%= 'show' if open %>">
        <%= render 'folders.html', key: folder.id %>
      </ul>
    </li>
  <% end %>
<% end %>
